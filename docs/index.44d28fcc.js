/*! signal-v-noise v2022.11.02 | (c) 2024 benjmnrsh | ISC License | https://github.com/bnjmnrsh-projs/signal-v-noise */

const e=["home","arts","automobiles","books","business","climate","dining","fashion","food","health","insider","magazine","movies","nyregion","obituaries","opinion","politics","realestate","science","sports","style","sundayreview","technology","theater","t-magazine","travel","upshot","us","world"],t=function(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML};const n=function(){const e=window.location.hash.replace("#","");document.querySelector("nav.noise").querySelectorAll(".pill").forEach((function(t){t.classList.contains(e)?(console.log(`navActiveLink: setting active link: ${e}`),t.classList.add("active")):t.classList.remove("active")}))},o=function(e={},t=".observable",n="loaded"){e={...{root:document.querySelector("body"),rootMargin:"0px",threshold:1},...e};const o=document.querySelectorAll(t);if(!o.length)return void console.warn("No observerable elements named",t);const r=new IntersectionObserver((function(e){e.forEach((e=>{e.isIntersecting&&e.target.classList.add(n)}))}),e);o.forEach((e=>r.observe(e)))},r=function(r){const s=document.querySelector("#articles"),i=document.querySelector("#loader");i.style.opacity=1,n(),s.innerHTML=r.top_stories.results.map((function(n){const o=e.indexOf(t(n.section))>=0;if(!o&&("admin"===n.section||"espanol"===n.section))return"";if(!n.abstract)return"";let r=`<li>\n                                    <article class="news-item ${t(n.section)}">\n                                        <header>`;return"multimedia"in n&&null!==n.multimedia&&n.multimedia.length>=3&&(r+=`<a href="${t(n?.url)}" title="${t(n.title)}">\n                                                <img class="loading-bg"\n                                                scrset="${t(n.multimedia[0]?.url)} ${t(n?.multimedia[0]?.width)}w,\n                                                    ${t(n.multimedia[1]?.url)} ${t(n?.multimedia[1]?.width)}w,\n                                                    ${t(n.multimedia[2]?.url)} ${t(n?.multimedia[2]?.width)}w,\n                                                    ${t(n.multimedia[3]?.url)} ${t(n?.multimedia[3]?.width)}w"\n                                                src="${t(n.multimedia[1]?.url)}"\n                                                 height="${t(n.multimedia[1]?.height)}"\n                                                 width="${t(n?.multimedia[1]?.width)}"\n                                                alt="${t(n?.multimedia[1]?.copyright)}" loading="lazy" role="presentation"/>\n                                            </a>`),r+=`</header>\n                                        <section class="news-content">\n                                            <header>\n                                                <h3 class="hyphens"><a href="${t(n.url)}">${n.title}</a></h3>\n                                                  <p class="details">`,o?r+=`<a class="pill ${t(n.section)}" href="https://www.nytimes.com/section/${t(n.section)}">`:n.section&&(r+=`<span class="pill ${t(n.section)}">`),r+=`${t(n.section)} ${o?"</a>":"</span>"}\n                                                    ${n?.byline?'<span class="byline">':""}\n                                                    ${n?.byline?t(n?.byline):""}\n                                                    ${n?.byline?"</span>":""}\n                                                </p>\n                                            </header>\n                                            <div class="abstract">`,n.abstract&&(r+=`<p class="hyphens">${t(n?.abstract)}\n                                        <a href="${t(n.url)}" title="${t(n.title)}" class="read-more">[...more]</a>\n                                      </p>`),r+="</div>\n                                        </section>\n                                    </article>\n                                </li>",r})).join(""),i.style.opacity=0,o({root:document.querySelector("#newsfeed-wrap"),threshold:.25},".news-item")};function s(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function i(e,t){return t.get?t.get.call(e):t.value}function a(e,t){return i(e,s(e,t,"get"))}function l(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function c(e,t,n){l(e,t),t.set(e,n)}function u(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}function d(e,t,n){return u(e,s(e,t,"set"),n),n}function h(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function m(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}function w(e,t,n){return m(e,t),n}var f,p,y,g=new WeakMap,b=new WeakMap,v=new WeakMap,S=new WeakSet;
/* ! @preserve @bnjmnrsh/satchel v0.2.4.1 | (c) 2022 bnjmnrsh | ISC | https://github.com/bnjmnrsh/satchel */class ${static set stcl(e){if("string"!=typeof e)throw new Error("Satchel.stcl must be a string.");this._stcl=e}static get stcl(){return this._stcl?this._stcl:"stcl"}age(){const e=JSON.parse(a(this,b).getItem(a(this,g)));return e?{age:Date.now()-e._creation,creation:e._creation,expiry:e.expiry?e.expiry:null,fresh:this.isFresh()}:null}bin(){const e=a(this,b).getItem(a(this,g));return e?(a(this,b).removeItem(a(this,g)),w($,$,E).call($,{key:a(this,g),oldValue:e,storageArea:w($,$,k).call($,a(this,b)),action:"bin"}),!0):null}get(e=!1){const t=a(this,b).getItem(a(this,g));return t?!!(this.isFresh()&&!e||e)&&JSON.parse(t):null}set({data:e,expiry:t}){const n=JSON.parse(a(this,b).getItem(a(this,g)));if(e=n?.data&&!e?n.data:e,t=n?.expiry&&!t?n.expiry:t,e&&"string"!=typeof e&&"number"!=typeof e&&!h(this,S,L).call(this,e))throw new Error("Satchel.set({data}): must be either null or a number, string or object.");if("number"!=typeof t&&null!==t)throw new Error('Satchel.set({expiry}): "expiry" must be null or a number.');if(e&&h(this,S,L).call(this,e))try{JSON.parse(JSON.stringify(e))}catch(e){throw new Error(`Satchel.set({data}): ${e}`)}const o=this.get(!0),r={};return r.data=e||null,r.expiry=t||null,r._creation=o?._creation||Date.now(),a(this,b).setItem(a(this,g),JSON.stringify(r)),w($,$,E).call($,{key:a(this,g),newValue:JSON.stringify(r),oldValue:o?JSON.stringify(o):null,storageArea:w($,$,k).call($,a(this,b)),action:"set"}),this}isFresh(){const e=JSON.parse(a(this,b).getItem(a(this,g)));return e?!e?.expiry||e.expiry-Date.now()>0:null}getKey(){return a(this,g)}static getSatchel(e,t=!1,n="pocket"){if(!e)throw new Error('Satchel.getSatchel(key): a "key" is required.');if("string"!=typeof e)throw new Error('Satchel.getSatchel(key): "key" must be a string.');if("boolean"!=typeof t)throw new Error('Satchel.getSatchel(key, local): "local" must be a boolean.');if("string"!=typeof n)throw new Error('Satchel.getSatchel(key, local, pocket): "pocket" must be an string.');const o=`${$.stcl}.${n}.${e}`,r=t?window.localStorage:window.sessionStorage,s=JSON.parse(r.getItem(o));return s&&0!==s.length?new $(e,s,t,n):null}static setKey(e=null,t={},n=!1,o="pocket"){new $(e,t,n,o)}constructor(e=null,t={},n=!1,o="pocket"){var r,s;if(l(r=this,s=S),s.add(r),c(this,g,{writable:!0,value:void 0}),c(this,b,{writable:!0,value:void 0}),c(this,v,{writable:!0,value:void 0}),d(this,b,n?window.localStorage:window.sessionStorage),!e)throw new Error('Satchel: a "key" is required.');if("string"!=typeof e)throw new Error('Satchel: "key" must be a string.');if(!h(this,S,L).call(this,t))throw new Error("Satchel: {cargo} must be an object.");if("boolean"!=typeof n)throw new Error('Satchel: "local" must be a boolean.');if("string"!=typeof o)throw new Error('Satchel: "pocket" must be a string.');d(this,g,`${$.stcl}.${o}.${e}`),d(this,v,{data:void 0,expiry:null}),t={...a(this,v),...t},this.set(t)}}function E(e={}){e={key:null,newValue:null,oldValue:null,storageArea:null,url:window.location.href,action:null,...e};const t=new CustomEvent("Satchel",{bubbles:!0,cancelable:!0,detail:e});return document.dispatchEvent(t)}function k(e){return e===window.localStorage?"LocalStorage":"SessionStorage"}function L(e){return e&&"object"==typeof e&&e.constructor===Object}y=void 0,(p="_stcl")in(f=$)?Object.defineProperty(f,p,{value:y,enumerable:!0,configurable:!0,writable:!0}):f[p]=y;function q(e,t=!1){const n=$.getSatchel(e,!0,"svn-store");if(console.log("storedArticles section",n?.getKey()),console.log("storedArticles isFresh",n?.isFresh()),n?.isFresh()||!navigator.onLine||t){const o=n?.get(!navigator.onLine||t)?.data;return o?(console.log(`loading ${e} from store ...`),r(o),document.body.querySelector("#newsfeed-wrap").scrollTo(0,0),document.body.classList.remove("loading"),!0):(console.log(`${e} not in sessionStorage ...`),!1)}}const A=function(e="home"){const t=document.querySelector("#loader");t.style.opacity=1;if(!q(e)&&navigator.onLine){document.body.classList.add("loading");return new Promise((function(n,o){let s;console.log("fetching fresh articles..."),fetch("https://signal-v-noise-worker.bnjmnrsh.workers.dev?section="+e).then((function(e){if(document.body.classList.remove("loading"),s=e.json(),e.ok&&200===e.status)return s;throw e})).then((function(t){if("OK"!==t.top_stories.status)throw t;r(t);const n=Date.now()+12e4;return $.setKey(e,{data:t,expiry:n},!0,"svn-store"),document.body.querySelector("#newsfeed-wrap").scrollTo(0,0),t})).catch((function(n){t.style.opacity=0;const o=document.querySelector("#articles");if(o&&200!==n?.top_stories?.status){console.warn(`${n?.top_stories?.status} status code, attempting to load stale ${e} from store...`);q(e,!0)||(o.innerHTML=(r=n,console.warn("err",r),`\n<div id="ohnos">\n  <h3><span aria-hidden="true">⥀.⥀ <br/></span>Oh Nooos!</h3>\n  <p class="sr-only">There has been a critical error:</p>\n    <div>\n<pre>\n${r.stack||""}\n${r.type||""}\n${r.statusText||""} ${r.status||""}\n${429===r.top_stories?.status?`${r.top_stories.status} too many requests`:r.top_stories?.status}\n${r.top_stories?.error||""}\n${r.top_stories?.error_message?` Route not found: ${r.top_stories.error_message.split("/").pop().replace(".json","")}`:""}\n</pre>\n    </div>\n</div>`))}var r}))}))}},T=function(){let e=window.location.hash.replace("#",""),t=document.querySelector("#app").getAttribute("data-section");e=e||"home",!t&&e&&(t=e,e&&document.querySelector("#app").setAttribute("data-section",e)),"null"===e||"head"===e?(window.removeEventListener("hashchange",T),window.location.hash=t,setTimeout((()=>window.addEventListener("hashchange",T)),1)):e&&A(e)};function _(e=!1,t="pocket",n="stcl"){const o=e?window.localStorage:window.sessionStorage,r=Object.keys(o).map((e=>e.startsWith(n+"."+t)?e:"")).filter((e=>e));return Array.from(r)}window.addEventListener("hashchange",T);window.addEventListener("Satchel",(function(e){if("Satchel"!==e.type)return;if("svn-store"!==e.detail.key.split(".")[1])return;const t=e.detail.key.split(".")[2];document.querySelectorAll(`[data-section="${t}"]`).forEach((e=>{e.setAttribute("data-stored",!0)}))}
/* ! @preserve @bnjmnrsh/toast v0.1.0 | (c) 2022 bnjmnrsh | ISC | git+https://github.com/bnjmnrsh/Toast.git */));const x=function(e={}){const t={selector:"body",className:"toast"};return function(e){let n=0;const o={};if(o.settings={...t,...e},o.className=o.settings.className,o.target=document.querySelector(o.settings.selector),!o.target)throw new Error(`Toast: the target element "${o.settings.selector}" could not be found.`);return o.create=function(e,t=0,r=!1,s=!0,i=[],a=!1){if(!e)throw new Error("Toast.js requires a message string!");a=a||`${o.settings.selector}-${n++}`.toString();const l=document.createElement("div");return l.setAttribute("role","alert"),l.setAttribute("data-toast-id",a),l.classList.add(this.className,...i),t&&setTimeout((()=>l.remove()),t),r?(l.innerHTML=`${e} <button class="toast-close" arial-lable="close">&#x2715</button>`,l.addEventListener("click",(function(e){e.target.matches(".toast-close")&&(l.remove(),l.removeEventListener("click",close))}))):l.innerHTML=`${e}`,s?o.target.prepend(l):o.target.append(l),setTimeout((()=>l.innerHTML),1),a},o.destroy=function(e){if(!e)return!1;const t=document.querySelector(`[data-toast-id="${e}"]`);return!!t&&(t.remove(),o)},o}}(),N=function(e,t=!0){e&&e.forEach((function(e){t?"false"===e.dataset.stored&&(e.setAttribute("data-href",e.href),e.removeAttribute("href","href-disabled"),e.setAttribute("aria-disabled",!0)):(e.setAttribute("href",e.dataset.href),e.removeAttribute("aria-disabled"),e.removeAttribute("data-href"))}))},O=document.querySelector("#app");!function(){const e=navigator.onLine?"online":"offline";document.body.setAttribute("data-network",e);const t=new x;let n="",o=Date.now().toString();window.addEventListener("offline",(e=>{const r=document.querySelectorAll(".noise .pill");console.log(r),console.warn("Network unavailable"),o=Date.now(),N(r),document.body.setAttribute("data-network","offline"),n=t.create("Sorry, you are currently off line",0,!1,!0,["offline-notice"])})),window.addEventListener("online",(()=>{const e=document.querySelectorAll(".noise .pill");console.log(e),console.warn("Network available"),document.body.setAttribute("data-network","online"),N(e,!1),Date.now()-o>3e4&&T(),t.destroy(n)}))}(),function(e,t){const n=_(!0,"svn-store");e.querySelector("nav").innerHTML="<ul>"+t.map((function(e){return`<li><a href="#${e}" class="pill ${e}" data-section="${e}" data-stored="${n.includes("stcl.svn-store."+e)}">${e}</a></li>`})).join("")+"</ul>"}(O,e),T(),function(e,t=125){const n=document.querySelector(e),o=document.querySelector("#stt"),r=function(e){(e.scrollY||e.scrollTop)>t?(document.body.classList.add("scrolled"),o.classList.add("-is-revealed")):(document.body.classList.remove("scrolled"),o.classList.remove("-is-revealed"))};window.addEventListener("scroll",(e=>r(window))),n.addEventListener("scroll",(e=>r(n))),o.addEventListener("click",(e=>{document.scrollingElement.scrollTo(0,0),n.scrollTo(0,0)}))}("#newsfeed-wrap");
//# sourceMappingURL=index.44d28fcc.js.map
